<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompts du Livre - Enseigner avec l'IA</title>
    <meta name="description" content="Tous les prompts du livre organis√©s par chapitre et par mati√®re.">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Open+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/conversations.css">
</head>

<body>
    <header class="header">
        <nav class="nav-container">
            <a href="index.html" class="logo"><span class="logo-icon">üìö</span><span class="logo-text">Enseigner avec
                    l'IA</span></a>
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Menu"><i data-lucide="menu"></i></button>
            <ul class="nav-links" id="nav-links">
                <li><a href="index.html" class="nav-link">Accueil</a></li>
                <li><a href="conversations.html" class="nav-link active">Conversations</a></li>
                <li><a href="outils.html" class="nav-link">Outils</a></li>
                <li><a href="formation.html" class="nav-link">Formation</a></li>
                <li><a href="veille.html" class="nav-link">Veille</a></li>
            </ul>
            <div class="nav-actions">
                <button class="theme-toggle" id="theme-toggle" aria-label="Changer le th√®me">
                    <i data-lucide="sun" class="theme-icon-light"></i>
                    <i data-lucide="moon" class="theme-icon-dark"></i>
                </button>
            </div>
        </nav>
    </header>

    <main class="conversations-main">
        <div class="container">
            <section class="conversations-header">
                <span class="section-badge"><i data-lucide="message-square"></i> Prompts du livre</span>
                <h1 class="page-title">Biblioth√®que de prompts</h1>
                <p class="page-subtitle">57 prompts pr√™ts √† l'emploi, extraits du livre et organis√©s par th√®me</p>
            </section>

            <!-- Filters -->
            <section class="filters-section">
                <div class="filters-row">
                    <div class="filter-group">
                        <label for="filter-part">Partie</label>
                        <select id="filter-part">
                            <option value="">Toutes les parties</option>
                            <option value="P2 - M√©thodes">P2 - M√©thodes</option>
                            <option value="P3 - Disciplines">P3 - Disciplines</option>
                            <option value="P4 - M√©tiers">P4 - M√©tiers</option>
                            <option value="P5 - Futur">P5 - Futur</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-subject">Mati√®re</label>
                        <select id="filter-subject">
                            <option value="">Toutes les mati√®res</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-tested">Status</label>
                        <select id="filter-tested">
                            <option value="">Tous</option>
                            <option value="tested">Avec r√©ponses IA</option>
                            <option value="untested">Sans r√©ponse</option>
                        </select>
                    </div>
                    <div class="filter-group filter-search">
                        <label for="filter-search">Recherche</label>
                        <input type="text" id="filter-search" placeholder="Rechercher un prompt...">
                    </div>
                </div>
                <div class="results-count">
                    <span id="results-count">57</span> prompts trouv√©s
                    <span id="tested-count" class="tested-badge"></span>
                </div>
            </section>

            <!-- Prompts Grid -->
            <section class="prompts-list" id="prompts-list">
                <!-- Prompts will be loaded here dynamically -->
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 Fabien Boyer - √âditions Ellipses.</p>
            </div>
        </div>
    </footer>

    <script src="scripts/main.js"></script>
    <script>
        let allPrompts = [];
        let arenaResults = {};

        // Load both data sources
        Promise.all([
            fetch('data/prompts.json').then(r => r.json()),
            fetch('data/arena-results.json').then(r => r.json()).catch(() => [])
        ]).then(([prompts, arena]) => {
            allPrompts = prompts;
            // Index arena results by id
            arena.forEach(r => {
                if (r.responses && (r.responses.outputA || r.responses.outputB)) {
                    arenaResults[r.id] = r.responses;
                }
            });
            populateSubjectFilter();
            updateTestedCount();
            renderPrompts(allPrompts);
        }).catch(error => console.error('Error loading data:', error));

        // Populate subject filter
        function populateSubjectFilter() {
            const subjects = [...new Set(allPrompts.map(p => p.subject))].sort();
            const select = document.getElementById('filter-subject');
            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                select.appendChild(option);
            });
        }

        // Update tested count
        function updateTestedCount() {
            const testedCount = Object.keys(arenaResults).length;
            document.getElementById('tested-count').textContent =
                testedCount > 0 ? `‚Ä¢ ${testedCount} avec r√©ponses IA` : '';
        }

        // Render prompts
        function renderPrompts(prompts) {
            const container = document.getElementById('prompts-list');
            container.innerHTML = '';

            prompts.forEach(prompt => {
                const hasResponses = arenaResults[prompt.id];
                const card = document.createElement('article');
                card.className = 'prompt-card' + (hasResponses ? ' has-responses' : '');

                let responsesHTML = '';
                if (hasResponses) {
                    responsesHTML = `
                        <div class="responses-section">
                            <button class="toggle-responses" onclick="toggleResponses(this)">
                                <i data-lucide="bot"></i>
                                Voir les r√©ponses IA
                                <i data-lucide="chevron-down" class="chevron"></i>
                            </button>
                            <div class="responses-content" style="display: none;">
                                ${hasResponses.modelA && hasResponses.outputA ? `
                                    <div class="response-block">
                                        <div class="model-name">${escapeHtml(hasResponses.modelA)}</div>
                                        <div class="model-output">${marked.parse(hasResponses.outputA)}</div>
                                    </div>
                                ` : ''}
                                ${hasResponses.modelB && hasResponses.outputB ? `
                                    <div class="response-block">
                                        <div class="model-name">${escapeHtml(hasResponses.modelB)}</div>
                                        <div class="model-output">${marked.parse(hasResponses.outputB)}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="prompt-header">
                        <div class="prompt-meta">
                            <span class="prompt-part">${prompt.part}</span>
                            <span class="prompt-chapter">${prompt.chapter}</span>
                            ${hasResponses ? '<span class="prompt-tested">‚úì Test√©</span>' : ''}
                        </div>
                        <button class="copy-btn" title="Copier le prompt"><i data-lucide="copy"></i></button>
                    </div>
                    <h3 class="prompt-title">${prompt.title}</h3>
                    <span class="prompt-subject">${prompt.subject}</span>
                    <pre class="prompt-content">${escapeHtml(prompt.content)}</pre>
                    ${responsesHTML}
                `;

                // Copy functionality
                card.querySelector('.copy-btn').addEventListener('click', function () {
                    navigator.clipboard.writeText(prompt.content);
                    this.innerHTML = '<i data-lucide="check"></i>';
                    lucide.createIcons();
                    setTimeout(() => {
                        this.innerHTML = '<i data-lucide="copy"></i>';
                        lucide.createIcons();
                    }, 2000);
                });

                container.appendChild(card);
            });

            lucide.createIcons();
            document.getElementById('results-count').textContent = prompts.length;
        }

        // Toggle responses visibility
        function toggleResponses(btn) {
            const content = btn.nextElementSibling;
            const isHidden = content.style.display === 'none';
            content.style.display = isHidden ? 'block' : 'none';
            btn.querySelector('.chevron').style.transform = isHidden ? 'rotate(180deg)' : '';
            btn.innerHTML = isHidden
                ? '<i data-lucide="bot"></i> Masquer les r√©ponses IA <i data-lucide="chevron-up" class="chevron"></i>'
                : '<i data-lucide="bot"></i> Voir les r√©ponses IA <i data-lucide="chevron-down" class="chevron"></i>';
            lucide.createIcons();
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Filter prompts
        function filterPrompts() {
            const part = document.getElementById('filter-part').value;
            const subject = document.getElementById('filter-subject').value;
            const tested = document.getElementById('filter-tested').value;
            const search = document.getElementById('filter-search').value.toLowerCase();

            const filtered = allPrompts.filter(p => {
                const matchPart = !part || p.part === part;
                const matchSubject = !subject || p.subject === subject;
                const matchTested = !tested ||
                    (tested === 'tested' && arenaResults[p.id]) ||
                    (tested === 'untested' && !arenaResults[p.id]);
                const matchSearch = !search ||
                    p.title.toLowerCase().includes(search) ||
                    p.content.toLowerCase().includes(search) ||
                    p.chapter.toLowerCase().includes(search);
                return matchPart && matchSubject && matchTested && matchSearch;
            });

            renderPrompts(filtered);
        }

        // Event listeners
        document.getElementById('filter-part').addEventListener('change', filterPrompts);
        document.getElementById('filter-subject').addEventListener('change', filterPrompts);
        document.getElementById('filter-tested').addEventListener('change', filterPrompts);
        document.getElementById('filter-search').addEventListener('input', filterPrompts);
    </script>
</body>

</html>